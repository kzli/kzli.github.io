select * from (

    select 
    t1.id
      ,t1.operation_code
      ,t1.hospital_code
      ,t1.hospital_name
      ,t1.implant_time
      ,t1.implant_type
      ,hcp.id as hcp_id
      ,t1.hcp_code
      ,t1.hcp_name
      ,spe.id as special_id
      ,t1.special_hcp_code
      ,t1.special_name
      ,t1.gt_type
      ,t1.gt_man
      ,t1.has_manager
      ,t1.manager
      ,t1.diagnosis
      ,t1.machine_type
      ,t1.machine_number
      ,t1.gt_time
      ,t1.remark
      ,t1.create_time
      ,t1.submit_time
      ,t1.submit_user
      ,t1.status
      ,t1.import_id
      ,t1.last_update_time
      ,t1.last_update_user
      ,t1.delete_time
      ,t1.delete_user
      ,t1.operation_type
      ,t1.operator_id
      ,t1.operator
      ,t1.experter_code
      ,t1.technician_Type
      ,t1.technician
      ,t1.operation_hour
      ,t1.plan_code
      ,t1.v5_moudle
      ,t1.special_hospital_code
      ,t1.special_hospital_name
      ,t1.use_lsi, t1.lsi_before, t1.lsi_after,t1.use_ablation
      , t1.ablation_before, t1.ablation_after
      ,t7.team
      ,t7.area
      ,t7.[top_177]
      ,t7.segment
      ,month(t1.implant_time) as operationMonth
      ,t2.tsm_name,t3.province,t4.user_name as create_user,t5.type as product_type
      ,case when t6.hospital_code is not null then '是' else '否' end as is_v5
      ,t1.create_user as create_user_code
      ,row_number() over(order by t1.id desc) as rm
    from dw_td_operation_data_updated t1
	
    left join dw_td_hcp hcp on t1.hcp_code=hcp.hcp_code and t1.hcp_name=hcp.first_name
    left join dw_td_hcp spe on t1.special_hcp_code=spe.hcp_code and t1.special_name=spe.first_name
    left join (select distinct user_code,tsm_name from v_dw_user_relation) t2 on t1.create_user=t2.user_code
    left join (select distinct hospital_code,hospital_name,province from dw_td_hospital) t3 on t1.hospital_code=t3.hospital_code
    left join (select distinct user_code,user_name from dw_td_user) t4 on t1.create_user=t4.user_code
    left join dw_af_diagnosis t5 on t5.code=isnull(t1.technician_Type,'9998a')
    left join dw_td_v5_hospital t6 on t6.hospital_code=t1.hospital_code
    left join dw_af_hospital_extend t7 on t7.hospital_code=t1.hospital_code

    where implant_time >='2017-01-01'
    and t1.status!=-1
	
) k where rm between #{startRow} and #{endRow}
